### 消息队列相关面试题


1. Kafka如何保证消息的顺序性
一、Kafka的特性
kafka中，写入一个partition分区中的数据是一定有顺序的。

kafka中一个消费者消费一个partition的数据，消费者取出数据时，也是有顺序的。

访问Kafka技术专栏，了解更多的技术细节和项目代码。

二、多线程消费会导致消息乱序
比如说我们建了一个 topic，有三个 partition。生产者在写的时候，其实可以指定一个 key，比如说我们指定了某个订单 id 作为 key，那么这个订单相关的数据，一定会被分发到同一个 partition 中去，而且这个 partition 中的数据一定是有顺序的。

消费者从 partition 中取出来数据的时候，也一定是有顺序的。到这里，顺序还是 ok 的，没有错乱。

接着，我们在消费者里可能会搞多个线程来并发处理消息。因为如果消费者是单线程消费处理，而处理比较耗时的话，比如处理一条消息耗时几十 ms，那么 1 秒钟只能处理几十条消息，这吞吐量太低了。而多个线程并发跑的话，顺序可能就乱掉了。

由于消费者消费消息之后，有可能交给很多个线程去处理数据（如下图），这样就导致数据顺序错乱。


3. kafka如何保证消息不被重复消费？（如何保证消息消费的幂等性）
